<div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
        <b data-i18n="Image Auto Generation" style="color: #4a90e2;">ì˜¤í† í”½:ì´ë¯¸ì§€ ìë™ ìƒì„±</b>
        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content" style="padding: 15px; background-color: #1a1a1c; border-radius: 0 0 8px 8px; color: #ffffff;">
        
        <div class="image-gen-nav-container">
            <div class="image-gen-nav-item active" data-tab="tab-gen-general">âš™ï¸ ê¸°ë³¸ ì„¤ì •</div>
            <div class="image-gen-nav-item" data-tab="tab-gen-templates">ğŸ¨ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</div>
            <div class="image-gen-nav-item" data-tab="tab-gen-linking">ğŸ”— ìºë¦­í„° ì—°ë™</div>
        </div>
        
        <div id="tab-gen-general" class="image-gen-tab-content active">
            <div class="image-gen-card">
                <h3 class="gen-section-title">ğŸ¨ í…Œë§ˆ ì„¤ì •</h3>
                <div class="theme-selection-container">
                    <div class="theme-dot dark active" data-theme="dark" title="ë‹¤í¬"></div>
                    <div class="theme-dot light" data-theme="light" title="ë¼ì´íŠ¸"></div>
                    <div class="theme-dot pink" data-theme="pink" title="ë²šê½ƒ í•‘í¬"></div>
                </div>
            </div>

            <div class="image-gen-card">
                <h3 class="gen-section-title">ì‘ë™ ë°©ì‹</h3>
                <div class="flex-container flexnowrap margin-bottom-15" style="align-items: center; gap: 20px;">
                    <label for="image_generation_insert_type" style="flex-shrink: 0; min-width: 120px;">ì´ë¯¸ì§€ ì‚½ì… ìœ í˜•</label>
                    <select id="image_generation_insert_type" class="gen-custom-input flex1">
                        <option value="inline">í˜„ì¬ ë©”ì‹œì§€ì— ì‚½ì…</option>
                        <option value="replace">íƒœê·¸ ì¹˜í™˜ ëª¨ë“œ</option>
                        <option value="new">ìƒˆ ë©”ì‹œì§€ë¡œ ìƒì„±</option>
                        <option value="disabled">ì‚¬ìš© ì•ˆ í•¨</option>
                    </select>
                </div>
                <div class="flex-container flexnowrap" style="margin-top: 10px;">
                    <label class="gen-checkbox-label" for="prompt_injection_enabled">
                        <input type="checkbox" id="prompt_injection_enabled">
                        <span>í”„ë¡¬í”„íŠ¸ ì£¼ì… í™œì„±í™”</span>
                    </label>
                </div>
            </div>

            <div class="image-gen-card">
                <h3 class="gen-section-title">ê³ ê¸‰ ì¸ì ì…˜ ì„¤ì •</h3>
                <div style="margin-bottom: 25px;">
                    <label style="display:block; margin-bottom:5px; margin-top:5px; font-size:0.85rem; color: #cccccc; font-weight: bold;">ì¶”ì¶œ ì •ê·œì‹ (Regex)</label>
                    <textarea id="prompt_injection_regex" class="gen-custom-input" rows="2" placeholder="ì˜ˆ: /<pic[^>]*\sprompt=([^>]*?)>/g"></textarea>
                </div>
                <div class="flex-container flexnowrap margin-bottom-15" style="align-items: center; gap: 20px;">
                    <label style="flex-shrink: 0; min-width: 120px;">ì£¼ì… ìœ„ì¹˜</label>
                    <select id="prompt_injection_position" class="gen-custom-input flex1">
                        <option value="deep_system">System (ê¶Œì¥)</option>
                        <option value="deep_user">User</option>
                        <option value="deep_assistant">AI Assistant</option>
                    </select>
                </div>
                <div class="flex-container flexnowrap" style="align-items: center; gap: 20px;">
                    <label style="flex-shrink: 0; min-width: 120px;">ì£¼ì… ê¹Šì´ (Depth)</label>
                    <input id="prompt_injection_depth" class="gen-custom-input" type="number" min="0" max="100" style="width: 80px;">
                </div>
            </div>
        </div>

        <div id="tab-gen-templates" class="image-gen-tab-content">
			<div class="image-gen-card">
				<h3 class="gen-section-title">í…œí”Œë¦¿ ê´€ë¦¬</h3>
				<p style="font-size: 0.82rem; color: #ff9f43; margin-top: 9px; margin-bottom: 20px; line-height: 1.4;">
					<i class="fa-solid fa-circle-info"></i> <b>ì°¸ê³ :</b> ìˆ˜ì • í›„ <b>ì €ì¥</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê¸°ì¡´ ë‚´ìš©ì— ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. <b>+</b> ë²„íŠ¼ì€ ìƒˆ í…œí”Œë¦¿ì„ ì ê¸° ìœ„í•´ ì°½ì„ ë¹„ì›ë‹ˆë‹¤.
				</p>
				
				<div class="flex-container flexnowrap" style="align-items: center; margin-bottom: 25px; gap: 8px; margin-top: 10px;">
					<select id="prompt_preset_select" class="gen-custom-input" style="flex: 1;">
						<option value="" id="preset_default_option">-- í…œí”Œë¦¿ ì„ íƒ --</option>
					</select>
                    <button id="add_new_prompt_preset" class="gen-btn gen-btn-dark" title="ìƒˆ í…œí”Œë¦¿ ì¶”ê°€ (ì…ë ¥ì°½ ë¹„ìš°ê¸°)">
						<i class="fa-solid fa-plus"></i>
					</button>
                    <button id="rename_prompt_preset" class="gen-btn gen-btn-gray" title="ì´ë¦„ ìˆ˜ì •">
						<i class="fa-solid fa-pen-to-square"></i>
					</button>
					<button id="save_prompt_preset" class="gen-btn gen-btn-blue" title="ì €ì¥ (ë®ì–´ì”Œìš°ê¸°/ìƒˆë¡œì €ì¥)">
						<i class="fa-solid fa-floppy-disk"></i>
					</button>
					<button id="delete_prompt_preset" class="gen-btn gen-btn-red" title="ì‚­ì œ">
						<i class="fa-solid fa-trash"></i>
					</button>
				</div>
				<div>
					<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
					<label style="font-size:0.85rem; font-weight:bold; color: #4a90e2; margin:0;">í”„ë¡¬í”„íŠ¸ ë‚´ìš©</label>
						<span id="prompt_edit_status" style="font-size:0.75rem; padding: 2px 8px; border-radius: 4px; background: var(--ap-bg-item); color: var(--ap-text-vague);">
							ì „ì—­ ì„¤ì • í¸ì§‘ ì¤‘
						</span>
					</div>
					<textarea id="prompt_injection_text" class="gen-custom-input" rows="10" placeholder="AIì—ê²Œ ì´ë¯¸ì§€ íƒœê·¸ ìƒì„±ì„ ì§€ì‹œí•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
					<div id="character_prompts_section" style="margin-top: 25px; border-top: 1px dashed var(--ap-border); padding-top: 20px;">
						<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
							<label style="font-size:0.85rem; font-weight:bold; color: var(--ap-accent);">ğŸ‘¤ ìºë¦­í„° ì™¸í˜• í”„ë¡¬í”„íŠ¸ ({autopic_char1~6})</label>
							<button id="add_char_prompt_btn" class="gen-btn gen-btn-dark" style="padding: 4px 10px; font-size: 0.75rem;">
								<i class="fa-solid fa-plus"></i> ì¶”ê°€ (ìµœëŒ€ 6ëª…)
							</button>
						</div>
						<div id="char_prompts_list" style="display: flex; flex-direction: column; gap: 15px;">
							</div>
						<p style="font-size: 0.75rem; color: var(--ap-text-vague); margin-top: 10px; line-height: 1.4;">
							* í† ê¸€ì´ ì¼œì ¸ ìˆëŠ” ìºë¦­í„°ì˜ í”„ë¡¬í”„íŠ¸ë§Œ {autopic_charN} ìœ„ì¹˜ì— ì¹˜í™˜ë˜ì–´ ë“¤ì–´ê°‘ë‹ˆë‹¤. êº¼ì ¸ ìˆëŠ” ìºë¦­í„°ëŠ” í”„ë¡¬í”„íŠ¸ì—ì„œ í•´ë‹¹ ìë¦¬ê°€ ë¹ˆ ì¹¸ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ AIê°€ ì¸ì‹í•˜ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤.
						</p>
					</div>
				</div>
			</div>
		</div>

		<div id="tab-gen-linking" class="image-gen-tab-content">
			<div class="image-gen-card">
				<h3 class="gen-section-title">ğŸ”— ìºë¦­í„°ë³„ í”„ë¡¬í”„íŠ¸ ì—°ë™</h3>
				<p style="font-size: 0.85rem; color: var(--ap-text-vague); margin-bottom: 15px; line-height: 1.4;">
					íŠ¹ì • ìºë¦­í„°ì—ê²Œ íŠ¹í™”ëœ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
				</p>
				
				<div style="background: var(--ap-bg-input); padding: 15px; border-radius: 10px; border: 1px solid var(--ap-border); margin-bottom: 15px;">
					<div id="gen-char-link-info-area" style="font-size: 0.9rem; line-height: 1.6; color: var(--ap-text);">
						ìºë¦­í„° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
					</div>
				</div>

				<div class="flex-container flexGap10">
					<button id="gen-save-char-link-btn" class="gen-btn gen-btn-blue flex2" style="height: 42px; font-weight: bold;">
						<i class="fa-solid fa-link"></i> í˜„ì¬ ìºë¦­í„°ì— ì—°ë™
					</button>
					<button id="gen-remove-char-link-btn" class="gen-btn gen-btn-gray flex1" style="height: 42px;">
						ì—°ë™ í•´ì œ
					</button>
				</div>
				<div style="margin-top: 25px; border-top: 1px solid var(--ap-border); padding-top: 20px;">
					<h3 class="gen-section-title">ğŸ’¾ ì €ì¥ëœ ë°ì´í„° ê´€ë¦¬</h3>
					<p style="font-size: 0.8rem; color: var(--ap-text-vague); margin-bottom: 12px;">
						ìºë¦­í„°ë³„ë¡œ ì €ì¥ëœ ì™¸í˜• í”„ë¡¬í”„íŠ¸ ë° ì—°ë™ ì •ë³´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ì‚­ì œëœ ìºë¦­í„°ì˜ ì”ì—¬ ë°ì´í„°ë„ ì—¬ê¸°ì„œ ì§€ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
					</p>
					<button id="gen-open-storage-mgmt-btn" class="gen-btn gen-btn-dark" style="width: 100%; justify-content: center; background: var(--ap-bg-input) !important;">
						ğŸ“‚ ì €ì¥ëœ ìºë¦­í„° ë°ì´í„° ëª©ë¡ ë³´ê¸°
					</button>
					<div id="gen-storage-mgmt-list-container" style="display: none; margin-top: 10px; max-height: 300px; overflow-y: auto; border: 1px solid var(--ap-border); border-radius: 8px; background: var(--ap-bg-input);">
						<!-- ì—¬ê¸°ì— JSë¡œ ë¦¬ìŠ¤íŠ¸ ìƒì„± -->
					</div>
				</div>

				<div style="margin-top: 15px;">
					<button id="gen-toggle-linked-list-btn" class="gen-btn gen-btn-dark" style="width: 100%; justify-content: center; background: var(--ap-bg-input) !important;">
						ğŸ“‹ ì—°ë™ëœ ìºë¦­í„° ëª©ë¡ í™•ì¸
					</button>
					<div id="gen-linked-char-list-container" style="display: none; margin-top: 10px; max-height: 250px; overflow-y: auto; border: 1px solid var(--ap-border); border-radius: 8px; background: var(--ap-bg-input);">
						<!-- ì—¬ê¸°ì— JSë¡œ ë¦¬ìŠ¤íŠ¸ ìƒì„± -->
					</div>
				</div>
			</div>
		</div>

    </div>
</div>

<style>
/* 1. í…Œë§ˆë³„ ìƒ‰ìƒ ë³€ìˆ˜ ì •ì˜ */
#autopic_settings_container.theme-dark {
    --ap-accent: #4a90e2;
    --ap-bg-main: #1a1a1c;
    --ap-bg-card: #252529;
    --ap-bg-input: #121214;
    --ap-bg-item: rgba(0, 0, 0, 0.2); /* ì–´ë‘ìš´ ë°°ê²½ìš© ì•„ì´í…œ ë°•ìŠ¤ */
    --ap-text: #ffffff;
    --ap-text-vague: #888888;
    --ap-border: #333336;
    --ap-input-border: #444448;
}

#autopic_settings_container.theme-light {
    --ap-accent: #4a90e2;
    --ap-bg-main: #f2f2f2;
    --ap-bg-card: #ffffff;
    --ap-bg-input: #f9f9f9;
    --ap-bg-item: rgba(0, 0, 0, 0.05); /* ë°ì€ ë°°ê²½ìš© ì•„ì´í…œ ë°•ìŠ¤ */
    --ap-text: #2c3e50;
    --ap-text-vague: #7f8c8d;
    --ap-border: #dcdde1;
    --ap-input-border: #bdc3c7;
}

#autopic_settings_container.theme-pink {
    --ap-accent: #ff85a2;
    --ap-bg-main: #fff5f7;
    --ap-bg-card: #ffffff;
    --ap-bg-input: #fff0f3;
    --ap-bg-item: #ffe4e9; /* ë²šê½ƒí•‘í¬ í…Œë§ˆì— ì–´ìš¸ë¦¬ëŠ” ë¶€ë“œëŸ¬ìš´ ë¶„í™ìƒ‰ ë°•ìŠ¤ */
    --ap-text: #5d2a42;
    --ap-text-vague: #a67c8e;
    --ap-border: #ffcad4;
    --ap-input-border: #ffb7c5;
}

/* 2. ìºë¦­í„° ì™¸í˜• í”„ë¡¬í”„íŠ¸ ë¦¬ìŠ¤íŠ¸ ë†’ì´ ì œí•œ ë° ìŠ¤í¬ë¡¤ */
#char_prompts_list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-height: 500px; /* ë†’ì´ ì œí•œ ì•½ê°„ ìƒí–¥ */
    overflow-y: auto;
    padding-right: 8px;
    border: 1px solid transparent;
}

/* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
#char_prompts_list::-webkit-scrollbar {
    width: 6px;
}
#char_prompts_list::-webkit-scrollbar-thumb {
    background: var(--ap-border);
    border-radius: 10px;
}

.char-prompt-input {
    min-height: 60px; /* ê¸°ë³¸ ìµœì†Œ ë†’ì´ ì„¤ì • */
    resize: vertical; /* ì‚¬ìš©ìê°€ ì„¸ë¡œ í¬ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆë„ë¡ í—ˆìš© */
    width: 100%;
}


/* 3. ì—°ë™ëœ ìºë¦­í„° ëª©ë¡ ì•„ì´í…œ ë””ìì¸ (UI ê¹¨ì§ ìˆ˜ì •) */
.gen-linked-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    border-bottom: 1px solid var(--ap-border);
    background-color: var(--ap-bg-card);
    gap: 10px;
}

.gen-linked-item:last-child {
    border-bottom: none;
}

.gen-linked-item:hover {
    background-color: var(--ap-bg-input);
}

/* ë‚˜ë¨¸ì§€ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
#autopic_settings_container .theme-selection-container { display: flex; gap: 15px; padding: 5px 0; padding-top: 10px; }
#autopic_settings_container .theme-dot {
    width: 16px; height: 16px; border-radius: 50%; cursor: pointer;
    border: 2px solid transparent; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
#autopic_settings_container .theme-dot:hover { transform: scale(1.1); }
#autopic_settings_container .theme-dot.active { border-color: var(--ap-accent); transform: scale(1.1); }
#autopic_settings_container .theme-dot.dark { background-color: #1a1a1c; }
#autopic_settings_container .theme-dot.light { background-color: #ffffff; border: 1px solid #ddd; }
#autopic_settings_container .theme-dot.pink { background-color: #ffb7c5; }

#autopic_settings_container .inline-drawer-content {
    background-color: var(--ap-bg-main) !important;
    color: var(--ap-text) !important;
}

#autopic_settings_container .image-gen-nav-container {
    display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; padding-bottom: 5px;
    border-bottom: 2px solid var(--ap-border);
}

#autopic_settings_container .image-gen-nav-item {
    padding: 10px 8px; cursor: pointer; font-weight: 600; 
    color: var(--ap-text-vague); border-radius: 8px 8px 0 0; 
    transition: all 0.2s ease; white-space: nowrap; font-size: 0.8rem; 
    background-color: var(--ap-bg-card); flex: 1; min-width: 70px;
    text-align: center; overflow: hidden; text-overflow: ellipsis; 
}

#autopic_settings_container .image-gen-nav-item:hover { background-color: var(--ap-border); color: var(--ap-text); }
#autopic_settings_container .image-gen-nav-item.active { background-color: var(--ap-accent); color: #ffffff; }

#autopic_settings_container .image-gen-card {
    background-color: var(--ap-bg-card); padding: 22px; border-radius: 12px;
    border: 1px solid var(--ap-border); margin-bottom: 20px;
}

#autopic_settings_container .gen-section-title {
    font-size: 1.05rem; font-weight: bold; margin-bottom: 22px; color: var(--ap-accent);
    display: flex; align-items: center; gap: 10px; border: none; margin-top: 0;
}

#autopic_settings_container .gen-section-title::after { content: ""; flex-grow: 1; height: 1px; background: var(--ap-border); }

#autopic_settings_container .gen-custom-input {
    background-color: var(--ap-bg-input) !important;
    color: var(--ap-text) !important;
    border: 1px solid var(--ap-input-border) !important;
    border-radius: 8px !important; padding: 8px 12px !important;
    font-size: 0.9rem !important; outline: none !important; box-sizing: border-box;
	
}

#autopic_settings_container select.gen-custom-input {
    appearance: none !important; -webkit-appearance: none !important;
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23cccccc%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C/polyline%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important; background-position: right 10px center !important;
    background-size: 16px !important; padding-right: 40px !important;
}

#autopic_settings_container .gen-custom-input:focus { border-color: var(--ap-accent) !important; box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3); }

#autopic_settings_container .gen-btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer;
    font-size: 0.85rem; transition: filter 0.2s, transform 0.1s; color: #ffffff !important;
}

#autopic_settings_container .gen-btn-blue { background-color: var(--ap-accent) !important; }
#autopic_settings_container .gen-btn-red { background-color: #eb4d4b !important; }
#autopic_settings_container .gen-btn-gray { background-color: #4b4b4e !important; }
#autopic_settings_container .gen-btn-dark { background-color: var(--ap-bg-input) !important; border: 1px solid var(--ap-border) !important; color: var(--ap-text) !important; }

#autopic_settings_container .gen-checkbox-label { display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 0.95rem; color: var(--ap-text); }
#autopic_settings_container .gen-checkbox-label input[type="checkbox"] {
    appearance: none; -webkit-appearance: none; width: 20px; height: 20px;
    border: 2px solid var(--ap-accent); border-radius: 4px; background-color: var(--ap-bg-input);
    position: relative;
}
#autopic_settings_container .gen-checkbox-label input[type="checkbox"]:checked { background-color: var(--ap-accent); }
#autopic_settings_container .gen-checkbox-label input[type="checkbox"]:checked::after { content: 'âœ”'; position: absolute; color: white; font-size: 14px; left: 50%; top: 50%; transform: translate(-50%, -50%); }

#autopic_settings_container .image-gen-tab-content { display: none; }
#autopic_settings_container .image-gen-tab-content.active { display: block; animation: fadeInGen 0.3s ease-out; }
@keyframes fadeInGen { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
@media screen and (max-width: 500px) {
    #autopic_settings_container .flex-container.flexnowrap { flex-wrap: wrap !important; gap: 8px !important; }
    #autopic_settings_container .gen-custom-input { width: 100%; } /* !important ì œê±°í•˜ì—¬ ìˆ˜ë™ ë¦¬ì‚¬ì´ì§• ìš°ì„ ê¶Œ ë¶€ì—¬ */
}
</style>